<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="max-age=0">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 11:00:00 GMT">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="./css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="./css/fontawesome/css/all.css">
    <link rel="stylesheet" href="./css/material-kit/css/material-kit.min.css" type="text/css">
    <link rel="stylesheet" href="./css/material-overwrite.css" type="text/css">
    <link rel="stylesheet" href="./css/social.css" type="text/css">

    <script type="text/javascript" src="./config.js"></script>
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type="text/javascript" src="./js/popper.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap.min.js"></script>


    <script src="wise/script/shandler/SocialContent.js"></script>
    <script src="wise/script/wsSHandler.js"></script>

    <script>

        var shandler= parent.$('#phone-panel')[0].contentWindow.shandler;
        var sTicket = parent.$('#phone-panel')[0].contentWindow.currentTicket;
        var sMsglist= parent.$('#phone-panel')[0].contentWindow.currentMsglist;
        //var QueueList= parent.$('#phone-panel')[0].contentWindow.QueueList;

    </script>

    <style>
        /* This will affact datatable page style, cannot apply to every page */
        /* comment because box-size make module radio options style change */
        button,
        .reply-container {
            -webkit-box-sizing: unset;
            box-sizing: unset;
        }

        .box-sizing-border-box {
            box-sizing: border-box;
        }

        .to-history-hand {
            line-height: 59px;
            font-size: x-large;
            cursor: pointer;
        }

        .fb-more-comment-span {
            margin-left: 35px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css'>
    <!--<link rel="stylesheet" href="wise/script/shandler/style.css">-->
</head>
       
<body class='custom-scroll max-width-container' style='height: 100%; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size:14px' onkeydown='return (event.keyCode != 116)'
      onload="setLanguage();">

    <div style="width:100%;" id="construction-page">
        <div id='upper-section' style="width:100%;height:753px;">
            <div id="bubble-list" style="display:inline-block;width:251px;">
                <!-- <div class="active-chat-ques l-social-active-chat-ques"></div> -->
                <div id="bubble-list-inner" class="custom-scroll" style="overflow-y:auto;height:753px;border-bottom: 1px solid #E5E9F2;">
                </div>
                <input type="button" value="refresh" onclick="chatService.refreshTicketList()" />
            </div>



            <div id="content-section" style="display:block;width:calc(100% - 251px);float:right;">
                <div id="default-content-container">
                    <div class="default-content-title" style="height:58px">



                    </div>
                    <div class="content-section-inner" style="padding:15px;">
                        <div style="height:520px;overflow-y:auto;" class="custom-scroll" id="chatHistory">
                            <!--This area is actually output the reply and response message-->


                        </div>
                        <div class="reply-container">
                            <textarea class="reply-textarea" id="replyTextarea" rows="2"></textarea>
                            <div class="reply-icon-group">
                                <button data-toggle="tooltip" data-placement="top"
                                        class="reply-canned-container reply-btns-disable  keyboard-icon">
                                    <span class="align-sub"><i class="far fa-keyboard"></i></span>
                                </button>
                                <button data-toggle="tooltip" data-placement="top"
                                        class="reply-share-container reply-btns-disable  keyboard-icon">
                                    <span class="align-sub"><i class="far fa-file"></i></span>
                                </button>
                                <button data-toggle="tooltip" data-placement="top"
                                        class="reply-end-container reply-btns-disable keyboard-icon">
                                    <span class="align-sub"><i class="fas fa-times"></i></span>
                                </button>
                                <button data-toggle="tooltip" data-placement="top" id="sendMsgButton" title="Send"
                                        class="reply-send-container">
                                    <img class="reply-icon-size" src="./images/send.svg">
                                </button>
                                <button style="display:none" data-toggle="tooltip" data-placement="top" id="testSendMsgButton" title="Send"
                                        class="reply-send-container">
                                    <img class="reply-icon-size" src="./images/send.svg">
                                </button>
                            </div>
                        </div>


                        <div class="reply-container" style="display:none"><textarea id="reply-textarea-1123724117" class="reply-textarea" maxlength="1000" rows="2" placeholder="Type your text here..." onkeypress="textareaPressed(event);" onkeyup="sendCSInput(1123724117)"></textarea><div class="reply-icon-group"><button id="canned-1123724117" class="reply-canned-container keyboard-icon" data-toggle="tooltip" data-placement="top" title="Select Message" onclick="cannedBtnClicked(&quot;campaignCRM&quot;)"><span class="align-sub"><i class="far fa-keyboard"></i></span></button><button id="share-1123724117" class="reply-share-container keyboard-icon" data-toggle="tooltip" data-placement="top" title="Select File" onclick="shareBtnClicked(&quot;campaignCRM&quot;)"><span class="align-sub"><i class="far fa-file"></i></span></button><input type="file" onchange="uploadAttachment(this, 1123724117);" style="display:none"><button id="upload-1123724117" class="reply-share-container keyboard-icon" data-toggle="tooltip" data-placement="top" title="Send File" onclick="$(this).prev().trigger(&quot;click&quot;);"><span class="align-sub"><i class="fas fa-file-upload"></i></span></button><button id="end-1123724117" class="reply-end-container keyboard-icon" data-toggle="tooltip" data-placement="top" title="End Session" entry="webchat" onclick="endClicked(1123724117,this)"><span class="align-sub"><i class="fas fa-times"></i></span></button><button id="reply-btn-1123724117" class="reply-send-container" entry="webchat" onclick="replyClicked(1123724117)" data-toggle="tooltip" data-placement="top" title="Send Message"><img class="reply-icon-size" src="./images/send.svg"></button></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- <div style="width:100%;border-top: 1px solid #E5E9F2;" id="search-input-section"></div> -->
        <div style="width:100%;" id="search-input-section"></div>
    </div>
    <!-- Agent List Modal -->
    <div class="modal fade" id="agentListModal" tabindex="-1" role="dialog" aria-labelledby="agentListModalTitle"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 id="agentListModalTitle" class="modal-title l-social-add-agent-to-chat-room"></h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p style='display:flex;'>
                        <span class="module-campaign-span" style='flex:1;'>
                            <label>
                                <span class='l-social-campaign'></span>:
                            </label>&nbsp;<span id='agent-list-campaign'></span>
                        </span><span style='flex:1;'>
                            <label>
                                <span class='l-social-platform'></span>:
                            </label>&nbsp;<span id='agent-list-entry'></span>
                        </span><span style="margin-right:5px;">
                            <label>
                                <span class='l-social-ticket-id'></span>:
                            </label>&nbsp;<span id='agent-list-ticketid'></span>
                        </span>
                    </p>
                    <p>
                        <span class="l-social-message-to-the-invited-agent"></span>:
                        <input type="text" id="agent-list-message" style='width:98%;padding:5px;border-radius:5px;'
                               autocomplete="off">
                    </p>
                    <p>
                        <span class='l-social-agent-to-invite'></span>&nbsp;(IDLE, WORKING and READY only):
                        <form id="agent-list-arr"></form>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-default text-capitalize mr-3" data-dismiss="modal">
                        <i class="fas fa-times-circle mr-2"></i><span class="l-general-cancel"></span>
                    </button>
                    <button onclick="sendRequestClicked()" type="button"
                            class="btn btn-sm btn-warning text-capitalize">
                        <i class="fas fa-check-double mr-2"></i><span class="l-social-send-request"></span>
                    </button>
                </div>

            </div>
        </div>
    </div>
    <!-- Modal for enlarge image -->
    <div id="myModal" class="modal image-modal custom-scroll">
        <span class="close image-close" onclick="closeEnlageModal();">&times;</span>
        <img class="modal-content image-modal-content" id="img01">
        <div id="caption"></div>
    </div>
    <!-- /Modal for enlarge image -->
    <!-- Pass Input Form Moadal -->
    <div class="modal fade" id="inputFormModal" tabindex="-1" role="dialog" aria-labelledby="inputFormModalTitle"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="modal-title" id="inputFormModalTitle"
                          class="l-social-pass-input-form-to-agent">
                        Transfer Form
                    </span>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p style='display:flex;'>
                        <span style="margin-right:5px;">
                            <label>
                                <span class="l-social-ticket-id"></span>:
                            </label>&nbsp;<span id='input-form-ticketid'></span>
                        </span>
                    </p>
                    <p>
                        <span class="l-social-to-pass-the-input-form-to"></span>
                        <form id="input-form-arr"></form>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-default text-capitalize mr-3" data-dismiss="modal">
                        <i class="fas fa-times-circle mr-2"></i><span class="l-general-cancel"></span>
                    </button>
                    <button onclick="passFormConfirmClicked()" type="button"
                            class="btn btn-sm btn-warning text-capitalize">
                        <i class="fas fa-clipboard-check mr-2"></i><span class="l-general-confirm"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
    <!-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
    <!-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
    <!--For load template-->
    <div id="template">
        <script id="message-template" type="text/x-handlebars-template">
            <li class="clearfix">
                <div class="message-data align-right">
                    <span class="message-data-time">{{time}}, Today</span> &nbsp; &nbsp;
                    <span class="message-data-name">{{sendBy}}</span> <i class="fa fa-circle me"></i>
                </div>
                <div class="message other-message float-right">
                    {{messageOutput}}
                </div>
            </li>
        </script>

        <script id="message-response-template" type="text/x-handlebars-template">
            <li>
                <div class="message-data">
                    <span class="message-data-name"><i class="fa fa-circle online"></i> Agent </span>
                    <span class="message-data-time">{{time}}, Today</span>
                </div>
                <div class="message my-message">
                    {{response}}
                </div>
            </li>
        </script>
        <script id="ticket-list-template" type="text/x-handlebars-template">
            <li class="clearfix">
                <img src="Wise/img/webchat-icon-217.png" style="height:30px; width:30px" alt="avatar" />
                <div class="about">

                    <div class="name">{{name}}</div>
                    <div class="status">
                        <i class="fa fa-circle online"></i> online
                    </div>
                    <div class="updateat">{{updateat}}</div>
                    <div class="lsmessage">{{lsmessage}}</div>
                </div>
            </li>
        </script>

        <script id="agent_message_template" type="text/x-handlebars-template">
            <div id="-1310755465" class="message-row agent-row">
                <div class="agent-content-bubble content-bubble">
                    <div class="content-bubble-name">agent</div>
                    <div class="content-bubble-content">{{messageOutput}}</div>
                </div>
                <div>
                    <span class="user-icon"><i class="fas fa-user"></i></span>
                    <div class="time-with-seconds" title="2024-11-05 10:47:31"><span></span><span>10:47:31</span></div>
                </div>
            </div>
        </script>
        <script id="visitor_message_template" type="text/x-handlebars-template">
            <div id="2135790869" class="message-row visitor-row">
                <div>
                    <span class="user-icon">
                        <i class="fas fa-user"></i>
                    </span>
                    <div class="time-with-seconds" title="2024-11-05 10:47:33">
                        <span></span>
                        <span>10:47:33</span>
                    </div>
                </div>
                <div class="visitor-content-bubble content-bubble">
                    <div class="content-bubble-name">{{SentBy
                        }}
                    </div>
                    <div class="content-bubble-content">{{response}}</div>
                </div>
            </div>
        </script>

        <script id="status_update_template" type="text/x-handlebars-template">
            <div id="end300098934" class="text-center my-3">
                <span class="status-bubble">{{status}}</span>
            </div>
        </script>

        <script id="chatlist_header_template" type="text/x-handlebars-template">
            <div style="padding:7px 10px 0px 10px;">
                <span class="custom-scroll content-basic-info" style="margin-top: -10px; margin-left: -15px">
                    <span class="cs-info-span"><span class="content-gray-label">Platform:</span>&nbsp;webchat</span>
                    <span class="cs-info-span">
                        <span class="content-gray-label">Ticket ID:</span>{{ticketId}}
                    </span>
                    <span id="cs-basic-1213777168">
                        <span>
                            <span class="content-gray-label">Name:</span>{{name}}
                        </span>
                    </span>
                    <span id="cs-info-1213777168">
                        <span>
                            <span class="content-gray-label">Source:</span>&nbsp;www.commas.hk
                        </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <span><span class="content-gray-label">Language:</span>&nbsp;English</span>
                    </span>
                </span>
                <img id="channel-1213777168" class="top-channel-img" style="margin-top:-20px" data-toggle="tooltip" data-placement="left" src="./Wise/img/webchat-icon-217.png">
            </div>
        </script>

        <!--

        pending only:   bubble-container
        selected:       bubble-container bubble-present
        pending unread: bubble-container bubble-unread
        selected closed (timeout):  bubble-container bubble-present bubble-closed
        pending closed (timeout):  bubble-container bubble-closed
    -->

        <script id="bubble_template" type="text/x-handlebars-template">

            
            <div class="{{bubblestatus}}" style="height:58px" id="bubble-{{ticketId}}" campaign="campaignCRM" companycode="SM_Win2016-demoWebChat" enduserid="{{endUserId}}" onclick="chatService.selectTicket(this)">
                <div class="bubble-container-inner">
                    <span class="bubble-label-content-columns">
                        <span style="display: none;" class="bubble-id">{{ticketId}}</span>
                        <span style="display: none;" class="bubble-user-id">{{endUserId}}</span>
                        <span style="display: none;" class="bubble-user-email">{{endUserEmail}}</span>
                        <span style="display: none;" class="bubble-user-phone">{{endUserPhone}}</span>
                        <span style="display: none;" class="bubble-channel">{{channel}}</span>
                        <span style="display: none;" class="bubble-deviceid">{{deviceId}}</span>                        
                        <div class="bubble-channel-logo">
                            <img class="bubble-icon" src="./Wise/img/webchat-icon-217.png">
                        </div>
                        <div class="buble-content-column">
                            <div>
                                <span class="bubble-subject">{{endUserName}}</span>
                                <span style="float:right;">
                                    <span class="bubble-short-name"></span>&nbsp;
                                    <span class="bubble-datetime">
                                        <span class="bubble-date"></span>
                                        <span class="bubble-time">{{updatedAt}}</span>
                                    </span>
                                </span>
                            </div>
                            <div class="d-flex">
                                <span class="bubble-message mr-auto">{{lastMessage}}</span>
                                <i class="fas fa-plus bubble-small-icon mr-2" onclick="chatService.addAgent({{ticketId}},&quot;campaignCRM&quot;,&quot;webchat&quot;)" data-toggle="tooltip" data-placement="bottom" title="Conference Call"></i>
                                <i class="fas fa-sign-out-alt leave-chat-icon bubble-small-icon" onclick="leaveChat({{ticketId}})" data-toggle="tooltip" data-placement="bottom" title="Leave Chat"></i>
                                <i class="fas fa-star private-i"></i>
                            </div>
                        </div>
                    </span>
                </div>
            </div>
        </script>



        <!-----End of loading template__-------------------------------------------------------------------------------------------------------------------------------------------------->
        <!-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
        <!-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->

    </div>
    
    <div id="variableStatus">Variable value will appear here</div> 
    <!----------------------------------------------------------------------------------------------------->

    
    <script>
// For load template before loading chat service
   //   $("#template").load("wise/script/shandler/chatTemplate.js");
    </script>



    <script src='wise/script/shandler/handlebars.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/list.js/1.1.1/list.min.js'></script>

    <script src="wise/script/shandler/chatscripts.js"></script>


    <script>
                
           var shandler = parent.$('#phone-panel')[0].contentWindow.shandler;
        	var sTicket = parent.$('#phone-panel')[0].contentWindow.currentTicket;
			var sMsglist= parent.$('#phone-panel')[0].contentWindow.currentMsglist;
            var reloadScreen = parent.$('#phone-panel')[0].contentWindow.reloadedByGetTicket;
                
                var chatService = new chat();
          //      var ticketService = new ticket();
                chatService.init();


                //chatService.refreshTicketList();

                //Handle the user click from queuelist on the top 
                if (reloadScreen)
                {
                    chatService.reloadByGetTicket();
                }
            
                



    </script>

</body>
</html>

