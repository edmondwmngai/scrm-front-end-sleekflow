<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<link rel="stylesheet" href="../css/fontawesome/css/all.css">
<link rel="stylesheet" href="../css/alertPopup.css" type="TEXT/CSS">


<head>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <title> Alert from SCRM</title>
</head>



<body class="custom-scroll">

    <embed name="GoodEnough" src="./slow-spring-board-longer-tail.mp3" loop="false" hidden="true" autostart="true">
	<div class='card mt-5 mb-3'>
		<div class='card-header card-header-text card-header-info'>
		<h5 class="my-0"><i class="fas fa-bell mr-2"></i>Alert box from SCRM</h5>
		</div>
		<div class='card-body'>
			<div id="msg-container"></div>
		</div>
	
	</div>
</body>
<script>
$( document ).ready(function() {
	var now=new Date();
	var message = [];
	var originalMsgArr = window.opener.originalMsgArr;
	if (originalMsgArr==null) originalMsgArr=[];
	//var originalMsgArr =[];
	var bgColor="";
	var msgContainerStr = '';
	for(var i=0; i<originalMsgArr.length;i++){
		var theMsg =  originalMsgArr [i] ;
		if(theMsg != null){
			bgColor="yellow";
			//if (theMsg.waitTime>=12) bgColor="red";
			//else if (theMsg.waitTime>=6 && theMsg.waitTime<12 && bgColor=="") bgColor="yellow";
			msgContainerStr += '<div><h4>' + originalMsgArr[i].msg + '</h4></div>';
		}
	}
	if (bgColor!="") $("body").css("background",bgColor);
	$('#msg-container').append(msgContainerStr);
	//setInterval(function(){ checking(); }, 1000);
});

function checking()
{
	var bgColor="";
	var now=new Date();
	var originalMsgArr = window.opener.originalMsgArr;
	for(var i=0; i<originalMsgArr.length;i++){
		var theMsg =  originalMsgArr [i] ;
		if(theMsg != null){
			//alert(theMsg);
			//var diff= (now.getTime() - theMsg.time.getTime())/1000; 
			//if (diff>=15) bHighlight=true;
			theMsg.waitTime++;
			if (theMsg.waitTime>=12) bgColor="red";
			else if (theMsg.waitTime>=6 && theMsg.waitTime<12 && bgColor=="") bgColor="yellow";
		}
	}
	if (bgColor!="") $("body").css("background",bgColor);
}	

    // window.addEventListener('blur', function () {
  //      console.log('blur');
 //       window.opener.popupStatusChanged(true,newMessage);
 //   }, false);

 //   window.addEventListener('focus', function () {
 //       console.log('focus');
 //       window.opener.popupStatusChanged(false);
 //   }, false);

</script>

</html>